var e=require("net"),t=require("tls"),r=require("assert"),o=require("url"),n=globalThis.parcelRequire94c2,s=n.register;s("lMmYN",function(s,i){var p=s.exports&&s.exports.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);(!n||("get"in n?!t.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),c=s.exports&&s.exports.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=s.exports&&s.exports.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&p(t,e,r);return c(t,e),t},l=s.exports&&s.exports.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(s.exports,"__esModule",{value:!0}),s.exports.HttpsProxyAgent=void 0;let u=a(e),d=a(t),f=l(r),h=l(n("kYzEs"));var x=n("cdP5x"),y=n("dkiJo");let v=(0,h.default)("https-proxy-agent"),g=e=>void 0===e.servername&&e.host&&!u.isIP(e.host)?{...e,servername:e.host}:e;class m extends x.Agent{constructor(e,t){super(t),this.options={path:void 0},this.proxy="string"==typeof e?new o.URL(e):e,this.proxyHeaders=t?.headers??{},v("Creating new HttpsProxyAgent instance: %o",this.proxy.href);let r=(this.proxy.hostname||this.proxy.host).replace(/^\[|\]$/g,""),n=this.proxy.port?parseInt(this.proxy.port,10):"https:"===this.proxy.protocol?443:80;this.connectOpts={ALPNProtocols:["http/1.1"],...t?b(t,"headers"):null,host:r,port:n}}async connect(e,t){let r;let{proxy:o}=this;if(!t.host)throw TypeError('No "host" provided');"https:"===o.protocol?(v("Creating `tls.Socket`: %o",this.connectOpts),r=d.connect(g(this.connectOpts))):(v("Creating `net.Socket`: %o",this.connectOpts),r=u.connect(this.connectOpts));let n="function"==typeof this.proxyHeaders?this.proxyHeaders():{...this.proxyHeaders},s=u.isIPv6(t.host)?`[${t.host}]`:t.host,i=`CONNECT ${s}:${t.port} HTTP/1.1\r
`;if(o.username||o.password){let e=`${decodeURIComponent(o.username)}:${decodeURIComponent(o.password)}`;n["Proxy-Authorization"]=`Basic ${Buffer.from(e).toString("base64")}`}for(let e of(n.Host=`${s}:${t.port}`,n["Proxy-Connection"]||(n["Proxy-Connection"]=this.keepAlive?"Keep-Alive":"close"),Object.keys(n)))i+=`${e}: ${n[e]}\r
`;let p=(0,y.parseProxyResponse)(r);r.write(`${i}\r
`);let{connect:c,buffered:a}=await p;if(e.emit("proxyConnect",c),this.emit("proxyConnect",c,e),200===c.statusCode)return(e.once("socket",P),t.secureEndpoint)?(v("Upgrading socket connection to TLS"),d.connect({...b(g(t),"host","path","port"),socket:r})):r;r.destroy();let l=new u.Socket({writable:!1});return l.readable=!0,e.once("socket",e=>{v("Replaying proxy buffer for failed request"),(0,f.default)(e.listenerCount("data")>0),e.push(a),e.push(null)}),l}}function P(e){e.resume()}function b(e,...t){let r;let o={};for(r in e)t.includes(r)||(o[r]=e[r]);return o}m.protocols=["http","https"],s.exports.HttpsProxyAgent=m}),s("dkiJo",function(e,t){var r=e.exports&&e.exports.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.parseProxyResponse=void 0;let o=(0,r(n("kYzEs")).default)("https-proxy-agent:parse-proxy-response");e.exports.parseProxyResponse=function(e){return new Promise((t,r)=>{let n=0,s=[];function i(){let c=e.read();c?function(c){s.push(c),n+=c.length;let a=Buffer.concat(s,n),l=a.indexOf("\r\n\r\n");if(-1===l){o("have not received end of HTTP headers yet..."),i();return}let u=a.slice(0,l).toString("ascii").split("\r\n"),d=u.shift();if(!d)return e.destroy(),r(Error("No header received from proxy CONNECT response"));let f=d.split(" "),h=+f[1],x=f.slice(2).join(" "),y={};for(let t of u){if(!t)continue;let o=t.indexOf(":");if(-1===o)return e.destroy(),r(Error(`Invalid header from proxy CONNECT response: "${t}"`));let n=t.slice(0,o).toLowerCase(),s=t.slice(o+1).trimStart(),i=y[n];"string"==typeof i?y[n]=[i,s]:Array.isArray(i)?i.push(s):y[n]=s}o("got proxy server response: %o %o",d,y),p(),t({connect:{statusCode:h,statusText:x,headers:y},buffered:a})}(c):e.once("readable",i)}function p(){e.removeListener("end",c),e.removeListener("error",a),e.removeListener("readable",i)}function c(){p(),o("onend"),r(Error("Proxy connection ended before receiving CONNECT response"))}function a(e){p(),o("onerror %o",e),r(e)}e.on("error",a),e.on("end",c),i()})}});
//# sourceMappingURL=dist.b0f3ca19.js.map
